---
title: Search
layout: page
lunr_exclude: true
permalink: /search/
---

<div class="search-app" x-data="searchApp()" x-init="initIndex()">
    <form x-on:submit.prevent x-show="!isLoading">
        <input type="text" placeholder="Search for..." x-model="q">
        <button x-on:click="search()">Search</button>
    </form>

    <div class="results">
        <template x-if="results">
            <ul class="post-list">
                <template x-for="result in Object.values(results)">
                    <li>
                        <span class="result-title">
                            <a x-bind:href="result.url" x-text="result.title"></a>
                        </span>
                        <template x-if="result.doctree && doctrees[result.doctree]">
                            <span class="result-label" x-text="doctrees[result.doctree]"></span>
                        </template>
                    </li>
                </template>
            </ul>
        </template>
        <template x-if="(results != null) && (results.length == 0)">
            <div>Nothing found.</div>
        </template>
    </div>
</div>

<script src="https://polyfill.io/v3/polyfill.min.js?features=fetch%2CArray.prototype.forEach%2CArray.prototype.map"></script>
<script src="{{ "/search/lunr.min.js" | prepend: site.baseurl }}" type="text/javascript"></script>

<script type="text/javascript">
    function searchApp() {
        return {
            q: '',
            results: null,
            doctrees: null,
            pages: [],
            index: null,
            isLoading: false,

            initIndex: function() {
                this.isLoading = true;

                let pairs = window.location.hash.substring(1).split('&');
                let params = {};
                pairs.forEach((pair) => {
                    pair = pair.split('=');
                    params[pair[0]] = decodeURIComponent(pair[1] || '');
                });
                if (params.q) this.q = params.q;


                this.index = lunr(function () {
                    this.field('title', {boost: 10});
                    this.field('body');
                });

                fetch('{{ "/search/doctrees.json" | prepend: site.baseurl }}')
                    .then((results) => results.json())
                    .then((data) => this.doctrees = data);

                fetch('{{ "/search/search_entries.json" | prepend: site.baseurl }}')
                    .then((results) => results.json())
                    .then((entries) => {
                        entries.forEach((entry) => {
                            if (entry.category == '') return;
                            this.index.add(entry);
                            this.pages.push({ id: entry.id, title: entry.title, url: entry.url, doctree: entry.doctree });
                        });
                        this.isLoading = false;

                        if (this.q) this.search();
                    });
            },

            search: function() {
                if (this.q) window.location.hash = '#q=' + encodeURIComponent(this.q);
                let matches = this.index.search(this.q);
                if (matches && matches.length > 0) {
                    this.results = matches.map((match) => {
                        return this.pages.find((item) => item.id == match.ref);
                    });
                } else {
                    this.results = [];
                }
            }
        }
    }
</script>
