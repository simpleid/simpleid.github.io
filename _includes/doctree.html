{%- assign sections = collections.all | eleventyNavigation: key  -%}

{%- if section_headings -%}
  {%- assign section_tag = 'div' -%}
  {%- capture section_title_tag -%}h{{ section_headings }}{%- endcapture -%}  
  {%- if doc_title -%}
    {%- capture doc_title_tag -%}h{{ section_headings | minus: 1 }}{%- endcapture -%}
  {%- endif -%}
{%- else -%}
  {%- assign section_tag = 'li' -%}
  {%- assign section_title_tag = 'div' -%}
  {%- if doc_title -%}
    {%- capture doc_title_tag -%}{{ doc_title }}{%- endcapture -%}
  {%- endif -%}
{%- endif -%}

{% if doc_title %}
  <{{ doc_title_tag }} class="doc-title" {% if title_widget %}x-on:click="open = !open"{% endif %}>
    {%- if section_widget -%}
      <div class="doc-title-expander" x-bind:class="{ 'doc-title-expander-open': open }">
        <svg viewBox="0 0 24 24"><use xlink:href="#svg-expander"></use></svg>
      </div>
    {%- endif -%}
    <span>{{ sections[0].parent }}</span>
  </{{ doc_title_tag }}>
{% endif %}

<div class="doc-sections" {% if title_widget %}x-bind:class="{ 'doc-sections-open': open }"{% endif %}>
  {%- unless section_headings -%}
  <ul>
  {%- endunless -%}
    {% for section in sections %}
      {%- assign section_current = false -%}
      {%- for item in section.children -%}
        {%- if item.url == page.url -%}{%- assign section_current = true -%}{%- endif -%}
      {%- endfor -%}
      <{{ section_tag }} class="doc-section" data-key="{{ section.key }}" data-order="{{ section.order }}" {% if section_widget %}x-data="{ open: {{section_current}} }" x-bind:class="{ 'doc-section-current': open }"{% endif %}>
        <{{ section_title_tag }} class="doc-section-title"
          {% if section_headings %}id="{{ section.title | slugify }}"{% endif %}
          {% if section_widget %}x-on:click="open = !open"{% endif -%}
        >
          {%- if section_widget %}<div class="doc-section-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-expander"></use></svg></div>{% endif %}
          <div class="doc-section-title-text">{{ section.title }}</div>
        </{{ section_title_tag }}>

<ul>
          {%- for item in section.children %}
            {%- if item.url == page.url -%}
              {%- assign item_class = "current" -%}
            {%- else -%}
              {%- assign item_class = "" -%}
            {%- endif -%}
            <li class="doc-item {{ item_class }}" data-key="{{ item.key }}" data-order="{{ item.order }}"><a href="{{ item.url }}">{{ item.title }}</a></li>
          {% endfor -%}
        </ul>
      </{{ section_tag }}>
    {% endfor %}

  {%- unless section_headings -%}
  </ul>
  {%- endunless -%}
</div>